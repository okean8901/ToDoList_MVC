@{
    ViewData["Title"] = "Thống kê";
}

<h2>Thống kê</h2>

<canvas id="statusChart" width="400" height="200"></canvas>
<canvas id="createdChart" width="800" height="200" style="margin-top:20px;"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
fetch('@Url.Action("ApiStats")')
    .then(r => r.json())
    .then(data => {
        if (!data.success) return;

        // Status chart
        const statusLabels = data.byStatus.map(s => s.status);
        const statusData = data.byStatus.map(s => s.count);
        const ctx = document.getElementById('statusChart').getContext('2d');
        new Chart(ctx, {
            type: 'pie',
            data: {
                labels: statusLabels,
                datasets: [{ data: statusData }]
            }
        });

        // Created per day
        const dayLabels = data.byDay.map(d => d.date);
        const dayData = data.byDay.map(d => d.count);
        const ctx2 = document.getElementById('createdChart').getContext('2d');
        new Chart(ctx2, {
            type: 'bar',
            data: {
                labels: dayLabels,
                datasets: [{ label: 'Tạo trong 30 ngày', data: dayData }]
            }
        });
    });
</script>
